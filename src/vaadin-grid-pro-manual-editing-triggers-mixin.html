<!--
@license
Copyright (c) 2019 Vaadin Ltd.
This program is available under Commercial Vaadin Add-On License 3.0 (CVALv3).
See <a href="https://vaadin.com/license/cval-3">the website</a> for the complete license.
-->

<script>
  window.Vaadin = window.Vaadin || {};

  /** @namespace Vaadin.GridPro */
  window.Vaadin.GridPro = window.Vaadin.GridPro || {};

  /**
   * @polymerMixin
   * @memberof Vaadin.GridPro
   */
  Vaadin.GridPro.ManualEditingTriggersMixin = superClass => class ManualEditingTriggersMixin extends superClass {

    static get properties() {
      return {};
    }

    /** @protected */
    ready() {
      super.ready();
    }

    editCell(row, col, userOriginated) {
      if (isNaN(row) || isNaN(col) || (userOriginated && this.hasAttribute('disabled'))) {
        throw new Error('Invalid row/col or grid is disabled.');
      }

      const columns = this._getColumns().filter(col => !col.hidden);

      let colIdx = -1;
      if (isNaN(col)) { // If col is not a number, maybe it's because the id was passed instead
        const matchingColumn = columns.filter(c => c.id == col);
        if (!matchingColumn || matchingColumn.length == 0) {
          throw new Error(`col with id ${col} was not found`);
        }
        colIdx = columns.indexOf(matchingColumn[0]);
      } else {
        colIdx = col;
      }

      let rowIdx = -1;
      if (isNaN(row)) { // If row is not a number, maybe it's because the item was passed instead
        if (!row.hasOwnProperty('key')) {
          throw new Error('Invalid object passed as row item.')
        }
        rowIdx = row.key - 1;
      } else {
        rowIdx = row;
      }

      // Make sure col[colIdx] exists and is editable:
      if (colIdx > columns.length) {
        throw new Error('Invalid colIdx (out of bounds)')
      }

      const column = columns[colIdx]
      if (!this._isEditColumn(column)) {
        throw new Error('Column is not editable')
      }

      // Get rows (excluding header)
      const tRows = this.$.table.getElementsByTagName('tbody').items.rows;


      // Make sure row[rowIdx] exists
      if (rowIdx > tRows.length) {
        throw new Error('Invalid rowIdx (out of bounds)')
      }

      this._startEdit(tRows[rowIdx].cells[colIdx], column)
    }

  };


</script>
